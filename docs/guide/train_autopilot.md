# 自動運転を作成する

Donkey では 3 種類の自動運転方式をサポートしています。ディープラーニング方式、パスフォロー方式、コンピュータビジョン方式です。

[Donkeycar アプリの作成](/guide/create_application) セクションで学んだように、`createcar` コマンドで **mycar** フォルダーを作成する際、使用するテンプレートを選択します。

この章ではテンプレートの目的を説明し、その後に自動運転の学習方法を解説します。

## ディープラーニング自動運転
前方カメラ 1 台と畳み込みニューラルネットワークを用い、模倣学習（Behavioral Cloning）によって自動運転を実現します。人間の運転動作を模倣することからこの名が付いています。Donkeycar が最初に対応した方式で、以下のような流れで進めます。

- **人が運転してデータを収集**します。手動運転中は毎秒 20 回、画像・スロットル値・ステアリング値を記録し、およそ 1 万件集めます。
- **データを整理**します。コースアウトや衝突などの誤った走行データは削除します。走行中に削除しても構いません。
- 収集したデータで **畳み込みニューラルネットワークを学習**します。
- 学習済みモデルを使い、画像から **スロットル値とステアリング値を推論**します。自動運転モードでは毎秒 20 回これを行い、車を動かします。

カメラ映像を利用するため照明条件が重要です。屋内のように環境を制御しやすい場所では扱いやすいですが、屋外では光の変化が大きく、調整が難しくなります。

**補足:** Donkeycar のディープラーニング走行は、Nvidia の論文 [End to End Learning for Self-Driving Cars](https://arxiv.org/pdf/1604.07316v1.pdf) を参考にしています。


[ディープラーニング自動運転の学習手順](./deep_learning/train_autopilot.md)


## パスフォロー自動運転（GPS やエンコーダを利用）
パスフォローテンプレートはディープラーニング方式の代替です。屋外では GPS が利用できるため、GPS 受信機で経路を記録し、それに沿って走行する自動運転を構成できます。流れは次の通りです。

- **人が運転してデータを収集**します。GPS から得られる (x,y) 座標をウェイポイントとして記録し、コースを一周してパスを作成します。
- 自動運転では GPS で得た現在位置から最も近い 2 点のウェイポイントを探し、パスに沿うようステアリングを調整します。これを毎秒 20 回実行します。

この内容の詳細は次のセクションで説明します。

[パスフォロー自動運転の学習手順](./path_follow/path_follow.md)

## コンピュータビジョン自動運転
色空間変換やエッジ検出などの従来手法を用いて画像から特徴を抽出し、ステアリングとスロットル値を算出します。事前のデータ収集が不要で、アルゴリズムやパラメータを変更してコースに合わせられる点が利点です。OpenCV ライブラリと Donkeycar が提供する部品を使い、独自アルゴリズムを容易に記述できるようになっています。

- **人** が CV アルゴリズムを選択し、ステアリングとスロットルの値が安定するようパラメータを調整します。
- **人** が車をコースに置き、ユーザーモードから自動運転モードに切り替えます。
- 自動運転モードではカメラ画像をアルゴリズムに渡し、ステアリングとスロットル値を生成します。これを毎秒 20 回繰り返します。

組み込みアルゴリズムの詳細や自作アルゴリズムの作成方法は次のセクションで説明します。

[コンピュータビジョン自動運転の詳細](./computer_vision/computer_vision.md)
